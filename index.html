<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>문제집 추천 알고리즘</title>
<style>
  body {
    background: #fff;
    font-family: "Noto Sans KR", sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
  }
  .chatbox {
    width: 420px;
    height: 660px;
    background: #F5B6CD; /* 기본 182C */
    border: 4px solid #F2779A; /* 183C */
    border-radius: 16px;
    box-shadow: 0 6px 24px rgba(0,0,0,0.2);
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }
  .header {
    background: #1E2A78; /* 2346C */
    color: #fff;
    text-align: center;
    padding: 12px;
    font-weight: 700;
  }
  .display {
    flex: 1;
    padding: 16px;
    overflow-y: auto;
  }
  .msg {
    background: #fff;
    border-radius: 10px;
    padding: 10px 14px;
    margin-bottom: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  .options, .foot {
    display: flex;
    justify-content: space-around;
    gap: 8px;
    padding: 10px;
  }
  button {
    flex: 1;
    padding: 10px;
    border: none;
    border-radius: 10px;
    background: #1E2A78;
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.2s ease;
  }
  button:hover { transform: scale(1.05); }
  .survey {
    padding: 12px;
    border-top: 2px solid #F2779A;
  }
  .survey textarea {
    width: 100%;
    border-radius: 10px;
    border: 1px solid #ccc;
    padding: 8px;
    margin-top: 6px;
    resize: none;
    font-family: inherit;
  }
  .hidden { display: none; }
  .rating input { margin-right: 4px; }
</style>
</head>
<body>
<div class="chatbox">
  <div class="header">문제집 추천 알고리즘</div>
  <div id="display" class="display"></div>
  <div id="survey" class="survey hidden">
    <div>이 알고리즘을 어떻게 평가하시겠습니까?</div>
    <div class="rating">
      <label><input type="radio" name="rate" value="5">5점</label>
      <label><input type="radio" name="rate" value="4">4점</label>
      <label><input type="radio" name="rate" value="3">3점</label>
      <label><input type="radio" name="rate" value="2">2점</label>
      <label><input type="radio" name="rate" value="1">1점</label>
    </div>
    <textarea id="comment" rows="3" placeholder="의견을 작성해주세요..."></textarea>
    <button id="submitFeedback">제출</button>
  </div>
  <div class="foot">
    <button id="backBtn">뒤로가기</button>
    <button id="restartBtn">처음으로</button>
    <button id="heartBtn">❤️</button>
  </div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwrC2UrWD0QeYKU4q7bnst9Jo7y26E7Jpg2H7II2hSHHAaIcKtdkXdG0hJWwKBXS32b/exec";

const display = document.getElementById('display');
const survey = document.getElementById('survey');
const submitBtn = document.getElementById('submitFeedback');
const heartBtn = document.getElementById('heartBtn');
const backBtn = document.getElementById('backBtn');
const restartBtn = document.getElementById('restartBtn');

function addMsg(text){
  const m = document.createElement('div');
  m.className = 'msg';
  m.textContent = text;
  display.appendChild(m);
  display.scrollTop = display.scrollHeight;
}

// === 챗봇 시뮬레이션 ===
function start(){
  display.innerHTML = "";
  addMsg("안녕하세요. 원하시는 문제집 종류를 선택해 주세요.");
  survey.classList.add('hidden');
  setTimeout(()=>addMsg("추천이 완료되었습니다."),1500);
  setTimeout(()=>survey.classList.remove('hidden'),2000);
}

// === 설문 제출 ===
submitBtn.onclick = async () => {
  const rating = document.querySelector('input[name="rate"]:checked');
  const comment = document.getElementById('comment').value.trim();
  if(!rating){ alert("평점을 선택해주세요."); return; }
  const data = { rating: rating.value, comment };
  try{
    await fetch(API_URL, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify(data)
    });
    alert("제출되었습니다! 감사합니다.");
    survey.classList.add('hidden');
    document.querySelectorAll('input[name="rate"]').forEach(r=>r.checked=false);
    document.getElementById('comment').value="";
  }catch(e){
    alert("제출 중 오류가 발생했습니다.");
  }
};

// === 설문 결과 보기 ===
heartBtn.onclick = async ()=>{
  const pw = prompt("비밀번호를 입력하세요:");
  if(pw !== "0411"){ alert("비밀번호가 틀렸습니다."); return; }
  display.innerHTML = "";
  addMsg("설문 데이터를 불러오는 중...");
  try{
    const res = await fetch(API_URL);
    const list = await res.json();
    const grouped = {};
    list.forEach(item=>{
      if(!grouped[item.rating]) grouped[item.rating] = [];
      grouped[item.rating].push(item.comment);
    });
    display.innerHTML = "";
    Object.keys(grouped).sort((a,b)=>b-a).forEach(r=>{
      const box = document.createElement('div');
      box.className='msg';
      box.style.background="#fff";
      box.style.border=`2px solid #1E2A78`;
      box.innerHTML = `<b>${r}점</b><br>${grouped[r].map(c=>"- "+c).join("<br>")}`;
      display.appendChild(box);
    });
  }catch(e){
    addMsg("데이터를 불러오는 중 오류 발생");
  }
};

// === 버튼 초기화 ===
backBtn.onclick = ()=>{ start(); };
restartBtn.onclick = ()=>{ start(); };

// 초기 시작
start();
</script>
</body>
</html>
