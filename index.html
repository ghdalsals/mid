<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë¬¸ì œì§‘ ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜</title>
<style>
:root {
  --bg-main: #ffffff;
  --chat-bg: #1d1d1f;
  --box-bg: #ffffff;
  --box-alt: #f5f5f7;
  --btn-bg: #2e2e30;
  --btn-hover: #3a3a3c;
  --btn-active: #505052;
  --text-main: #f5f5f7;
  --border-color: #333;
  --radius: 20px;
  --shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
  --transition: all 0.25s ease;
}

body {
  background-color: var(--bg-main);
  font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", "Noto Sans KR", sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  margin: 0;
}

.chat-container {
  background-color: var(--chat-bg);
  width: 420px;
  height: 600px;
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 20px;
  display: flex;
  flex-direction: column;
}

#chat-content {
  flex-grow: 1;
  overflow-y: auto;
  scroll-behavior: smooth;
  color: var(--text-main);
  font-size: 1rem;
}

h3 {
  font-weight: 600;
  font-size: 1.15rem;
  margin-bottom: 12px;
  color: var(--text-main);
}

.button {
  background-color: var(--btn-bg);
  color: var(--text-main);
  border: 1px solid var(--border-color);
  border-radius: 12px;
  padding: 10px 15px;
  margin: 8px 0;
  font-size: 1rem;
  cursor: pointer;
  width: 100%;
  transition: var(--transition);
  box-sizing: border-box;
}
.button:hover { background-color: var(--btn-hover); }
.button:active { background-color: var(--btn-active); transform: scale(0.98); }

.bottom-bar {
  display: flex;
  justify-content: space-between;
  gap: 8px;
  margin-top: 10px;
}

textarea {
  width: 100%;
  border-radius: 12px;
  padding: 10px;
  border: 1px solid #555;
  font-family: inherit;
  resize: none;
  font-size: 0.95rem;
  color: #000;
  background-color: var(--box-alt);
  box-sizing: border-box;
}

.recommend-item {
  background: var(--box-bg);
  color: #000;
  border-radius: 12px;
  padding: 8px 12px;
  margin: 6px 0;
  transition: var(--transition);
}
.recommend-item:nth-child(even) { background: var(--box-alt); }

.fade { animation: fadeIn 0.4s ease-in-out; }
@keyframes fadeIn { from {opacity: 0; transform: translateY(10px);} to {opacity: 1; transform: translateY(0);} }

/* âœ… ìˆ˜ì •: ì´ëª¨í‹°ì½˜ ì»¨í…Œì´ë„ˆ ì¢Œìš° ìŠ¤í¬ë¡¤ ì œê±° */
.emoji-container {
  display: flex;
  justify-content: space-around;
  align-items: center;
  flex-wrap: wrap;
  overflow-x: hidden;
  margin-top: 10px;
}
.emoji {
  font-size: 2rem;
  cursor: pointer;
  transition: transform 0.2s, filter 0.2s;
}
.emoji:hover { transform: scale(1.2); }
.selected { transform: scale(1.3); filter: drop-shadow(0 0 5px #fff); }

/* ë„˜íŒ¨ë“œ */
#numpad {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background-color: rgba(0,0,0,0.6);
  display: none;
  justify-content: center;
  align-items: center;
}

.numpad-container {
  background-color: #fff;
  padding: 25px;
  border-radius: 20px;
  box-shadow: var(--shadow);
  display: flex;
  flex-direction: column;
  align-items: center;
}

#numpad-display {
  background-color: #f9f9f9;
  color: #1d1d1f;
  font-size: 1.4rem;
  text-align: center;
  width: 180px;
  padding: 8px;
  border-radius: 10px;
  margin-bottom: 15px;
  border: 1px solid #ddd;
}

.numpad-grid {
  display: grid;
  grid-template-columns: repeat(3, 60px);
  grid-gap: 10px;
}

.numpad-button {
  background-color: #eee;
  color: #000;
  font-size: 1.2rem;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  transition: var(--transition);
}
.numpad-button:hover { background-color: #ddd; }
</style>
</head>

<body>
<div class="chat-container">
  <div id="chat-content"></div>
  <div class="bottom-bar">
    <button class="button" id="backBtn">â†</button>
    <button class="button" id="homeBtn">âŒ‚</button>
    <button class="button" id="heartBtn">ğŸ’–</button>
  </div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbypbNF4_cfeeRuscpeg6WcNMr1pM3S6Pz_XBoY6UCBOTKIRqSF_gqIau6RkkQpT-MCp/exec";

if (!localStorage.getItem("sessionId")) {
  localStorage.setItem("sessionId", "sess-" + Math.random().toString(36).substr(2, 9));
}
const SESSION_ID = localStorage.getItem("sessionId");

fetch(`${SCRIPT_URL}?action=visit&session=${SESSION_ID}`);

const data = {
  "ê°œë…ì„œ": {
    1: ["ìˆ˜í•™ì˜ ë°”ì´ë¸”","ë§ˆí”Œ êµê³¼ì„œ","ìˆ˜í•™ì˜ ì™•ë„","ì˜¬ë¦¼í¬ìŠ¤ ìˆ˜í•™","ê°œë… í”ŒëŸ¬ìŠ¤ ìœ í˜• ê³ ë“± ìˆ˜í•™","ì´ìœ ìˆëŠ” ìˆ˜í•™ ê°œë… SOS","ì…€íŒŒ í•´ë²•ìˆ˜í•™"],
    2: ["ìˆ˜í•™ì˜ ìƒ˜","ê°œë… ìˆ","í’ì‚°ì","ê°œë…ì›ë¦¬"],
    3: ["ê¸°ë³¸ ìˆ˜í•™ì˜ ì •ì„","ìˆ˜í•™ì¤‘ì‹¬ ê³ ë“±ìˆ˜í•™","ë©”ê°€ìŠ¤í„°ë”” ë¬¸ì œ ê¸°ë³¸ì„œ CPRìˆ˜í•™","ë” ê°œë… ë¸”ë™ë¼ë²¨"],
    4: ["ì‹¤ë ¥ ìˆ˜í•™ì˜ ì •ì„","ìˆ¨ë§ˆì¿°ë¼ìš°ë°"]
  },
  "ìœ í˜• ì‹¬í™”ì„œ": {
    1: ["ìˆ˜ë ¥ì¶©ì „","ìˆ˜í•™ì˜ ë°”ì´ë¸” BOB","ê°œë… í”ŒëŸ¬ìŠ¤ ìœ í˜• ë¼ì´íŠ¸","ë¼ì´íŠ¸ ìˆ","ìœ í˜• í•´ê²°ì˜ ë²•ì¹™","ì˜¬ë¦¼í¬ìŠ¤ ë‹¥í„°ë§"],
    2: ["ê°œë…ì›ë¦¬ RPM","í’ì‚°ì í•„ìˆ˜ìœ í˜•","ë‚´ê³µì˜ í˜","ì˜¬ë¦¬ë“œ","í•˜ì´ë¼ì´íŠ¸ ë‹¨ê¸° íŠ¹ê°•","ì‹¬í”Œ ìì´ìŠ¤í† ë¦¬"],
    3: ["ìˆ ìˆ˜í•™","ë§ˆí”Œ ì‹œë„ˆì§€","ì¼ë“±ê¸‰ ìˆ˜í•™","1ë“±ê¸‰ ë§Œë“¤ê¸°"],
    4: ["ì¼í’ˆ","ìš¸ë¦¼í¬ìŠ¤ ê³ ë‚œë„","ìˆ˜ëŠ¥ë‹¤í","ì ˆëŒ€ë“±ê¸‰","ìœ í˜•+ë‚´ì‹  ê³ ìŸì´","ë¸”ë™ë¼ë²¨","ë‚´ì‹  í•˜ì´ì•¤ë“œ","í˜„ìš°ì§„ ë‰´ëŸ°-ì‹œëƒ…ìŠ¤","ìˆ˜í•™ì˜ ì‹ "],
    5: ["TOT","531 í•˜ì´í¼","ì ˆëŒ€ë“±ê¸‰ ì½”ë“œì— ","í˜„ìš°ì§„ ë“œë¦´"]
  },
  "ê¸°ì¶œ": ["ìì´ìŠ¤í† ë¦¬","ì§± ì–´ë ¤ìš´ ìœ í˜• ê³ ë‚œë„ 4ì ì§œë¦¬ ìˆ˜í•™","ë„ˆí¬ë“¤ì˜ ê¸°ì¶œë¬¸ì œ","ë§ˆí”Œ ìˆ˜ëŠ¥ê¸°ì¶œì´ì •ë¦¬","ìˆ˜ëŠ¥ ê¸°ì¶œì˜ ë°”ì´ë¸”","ì‹¤ì „+ìˆ˜ëŠ¥ ê³ ìŸì´","ì–´ì‚¼ì‰¬ì‚¬","ë„ˆê¸°ì¶œ","ìˆ˜ëŠ¥ ê¸°ì¶œì˜ ë¯¸ë˜","ìˆ ê¸°ì¶œ","í‹°ì˜¤í”¼ í´ë˜ìŠ¤ ìˆ˜ëŠ¥ ê¸°ì¶œë¬¸ì œì§‘","ì´ë™í›ˆ ê¸°ì¶œë¬¸ì œì§‘","ë‹´ê¸ˆì§ˆ","ë°±ë¯¸","ê¸°ì¶œì˜ ê³ ë°±","ë§ˆë”í……","ì˜¬ë¦¼í¬ìŠ¤ ê¸°ì¶œë¬¸ì œì§‘"]
};

let satisfaction = "";
let currentPage = "home";
let selectedType = "";
let selectedLevel = "";

function scrollBottom() {
  const chat = document.getElementById("chat-content");
  chat.scrollTop = chat.scrollHeight;
}

function loadHome() {
  currentPage = "home";
  fetch(`${SCRIPT_URL}?action=home&session=${SESSION_ID}`);
  const chat = document.getElementById("chat-content");
  chat.innerHTML = `
    <div class="fade">
      <h3>ì–´ë–¤ ë¬¸ì œì§‘ ì¶”ì²œì´ í•„ìš”í•˜ì‹ ê°€ìš”?</h3>
      <button class="button" onclick="selectType('ê°œë…ì„œ')">ê°œë…ì„œ</button>
      <button class="button" onclick="selectType('ìœ í˜• ì‹¬í™”ì„œ')">ìœ í˜• ì‹¬í™”ì„œ</button>
      <button class="button" onclick="selectType('ê¸°ì¶œ')">ê¸°ì¶œ</button>
    </div>`;
}

function selectType(type) {
  selectedType = type;
  currentPage = "level";
  fetch(`${SCRIPT_URL}?action=select&type=${type}&session=${SESSION_ID}`);
  const chat = document.getElementById("chat-content");

  if (type === "ê°œë…ì„œ") {
    chat.innerHTML = `<h3>${type} ë‚œì´ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”</h3>` +
      [1,2,3,4].map(i => `<button class="button" onclick="showRecommend(${i})">${i}ë‹¨ê³„</button>`).join('');
  } else if (type === "ìœ í˜• ì‹¬í™”ì„œ") {
    chat.innerHTML = `<h3>${type} ë‚œì´ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”</h3>` +
      [1,2,3,4,5].map(i => `<button class="button" onclick="showRecommend(${i})">${i}ë‹¨ê³„</button>`).join('');
  } else {
    showRecommend();
  }
}

function showRecommend(level) {
  selectedLevel = level || "";
  currentPage = "result";
  fetch(`${SCRIPT_URL}?action=select&type=${selectedType}&level=${selectedLevel}&session=${SESSION_ID}`);
  const chat = document.getElementById("chat-content");
  const books = selectedType === "ê¸°ì¶œ" ? data["ê¸°ì¶œ"] : data[selectedType][selectedLevel];
  chat.innerHTML = `
    <div class="fade">
      <h3>ì¶”ì²œ ë¬¸ì œì§‘ ëª©ë¡</h3>
      <ul style="padding-left:0;">
        ${books.map(b => `<li class="recommend-item">${b}</li>`).join('')}
      </ul>
      <button class="button" onclick="openSatisfaction()">í‰ê°€í•˜ê¸°</button>
    </div>`;
}

// âœ… ë§Œì¡±ë„ í‰ê°€ ì¶”ê°€
function openSatisfaction() {
  currentPage = "review";
  const chat = document.getElementById("chat-content");
  chat.innerHTML += `
    <div id="satisfactionBox" class="fade">
      <h3>ì´ ì¶”ì²œì— ì–¼ë§ˆë‚˜ ë§Œì¡±í•˜ì‹œë‚˜ìš”?</h3>
      <div class="emoji-container">
        <span class="emoji" data-value="ë¶ˆë§Œì¡±">ğŸ˜¡</span>
        <span class="emoji" data-value="ì¡°ê¸ˆ ë¶ˆë§Œì¡±">ğŸ˜•</span>
        <span class="emoji" data-value="ë³´í†µ">ğŸ˜</span>
        <span class="emoji" data-value="ë§Œì¡±">ğŸ™‚</span>
        <span class="emoji" data-value="ë§¤ìš° ë§Œì¡±">ğŸ˜</span>
      </div>
    </div>`;
  document.querySelectorAll(".emoji").forEach(e =>
    e.addEventListener("click", selectSatisfaction)
  );
  setTimeout(scrollBottom, 200);
}

function selectSatisfaction(e) {
  const emojis = document.querySelectorAll(".emoji");
  emojis.forEach(el => el.classList.remove("selected"));
  e.target.classList.add("selected");
  satisfaction = e.target.getAttribute("data-value");

  const chat = document.getElementById("chat-content");
  if (!document.getElementById("reviewBox")) {
    chat.innerHTML += `
      <div id="reviewBox" class="fade">
        <textarea id="reviewText" rows="3" placeholder="ì˜ê²¬ì„ ì‘ì„±í•´ì£¼ì„¸ìš”..."></textarea>
        <button class="button" onclick="submitReview()">ì œì¶œ</button>
      </div>`;
  }
  setTimeout(scrollBottom, 200);
}

async function submitReview() {
  const text = document.getElementById("reviewText").value.trim();
  if (!text) return alert("ì˜ê²¬ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
  await fetch(`${SCRIPT_URL}?action=review&type=${selectedType}&level=${selectedLevel}&review=${encodeURIComponent("[" + satisfaction + "] " + text)}&session=${SESSION_ID}`);
  alert("í‰ê°€ê°€ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤!");
  loadHome();
}

loadHome();
</script>
</body>
</html>
