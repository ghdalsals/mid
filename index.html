<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ë¬¸ì œì§‘ ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜</title>

<style>
:root {
  --theme-bg: #E9C4D7;        /* ì±„íŒ…ì°½ ë‚´ë¶€ */
  --button-bg: #A13D63;       /* ë²„íŠ¼ ìƒ‰ìƒ */
  --outer-bg: #FFFFFF;        /* ì™¸ë¶€ ë°°ê²½ */
  --text-main: #000000;
  --text-light: #FFFFFF;
  --highlight: rgba(255,192,203,0.8);
  --radius: 25px;
}

body {
  background-color: var(--outer-bg);
  font-family: 'Noto Sans KR', sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  margin: 0;
}

.chat-container {
  background-color: var(--theme-bg);
  width: 420px;
  min-height: 600px;
  border-radius: var(--radius);
  box-shadow: 0 4px 20px rgba(0,0,0,0.2);
  padding: 20px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  animation: fadeIn 0.7s ease;
}

@keyframes fadeIn {
  from {opacity: 0;}
  to {opacity: 1;}
}

#chat-content {
  flex-grow: 1;
  color: var(--text-main);
  font-size: 1rem;
}

.button {
  background-color: var(--button-bg);
  color: var(--text-light);
  border: none;
  border-radius: var(--radius);
  padding: 12px 20px;
  margin: 8px 0;
  font-size: 1rem;
  cursor: pointer;
  transition: 0.25s;
}

.button:hover {
  background-color: var(--highlight);
  color: #000;
  transform: scale(1.05);
}

.bottom-bar {
  display: flex;
  justify-content: space-between;
  margin-top: 10px;
}

.fade {
  animation: fadeIn 0.5s ease;
}

/* ë„˜íŒ¨ë“œ ìŠ¤íƒ€ì¼ */
#numpad {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.6);
  display: none;
  justify-content: center;
  align-items: center;
}

.numpad-container {
  background-color: var(--theme-bg);
  padding: 20px;
  border-radius: var(--radius);
  display: grid;
  grid-template-columns: repeat(3, 60px);
  grid-gap: 10px;
  justify-content: center;
  text-align: center;
}

.numpad-button {
  background-color: var(--button-bg);
  color: var(--text-light);
  font-size: 1.2rem;
  border: none;
  border-radius: var(--radius);
  cursor: pointer;
  transition: 0.2s;
}

.numpad-button:hover {
  background-color: var(--highlight);
  color: var(--text-main);
}
</style>
</head>

<body>
<div class="chat-container">
  <div id="chat-content"></div>

  <!-- í•˜ë‹¨ ë²„íŠ¼ë°” (í•­ìƒ ì¡´ì¬) -->
  <div class="bottom-bar">
    <button class="button" id="backBtn">ğŸ”™ ë’¤ë¡œê°€ê¸°</button>
    <button class="button" id="homeBtn">ğŸ  ì²˜ìŒìœ¼ë¡œ</button>
    <button class="button" id="heartBtn">ğŸ’–</button>
  </div>
</div>

<!-- ë„˜íŒ¨ë“œ -->
<div id="numpad">
  <div class="numpad-container">
    <button class="numpad-button">1</button>
    <button class="numpad-button">2</button>
    <button class="numpad-button">3</button>
    <button class="numpad-button">4</button>
    <button class="numpad-button">5</button>
    <button class="numpad-button">6</button>
    <button class="numpad-button">7</button>
    <button class="numpad-button">8</button>
    <button class="numpad-button">9</button>
    <button class="numpad-button">0</button>
    <button class="numpad-button" id="clearBtn">Clear</button>
    <button class="numpad-button" id="enterBtn">Enter</button>
  </div>
</div>

<script>
// âœ… Google Apps Script URL
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzkp09NYXwtejuByVP7Rd9oOMNkuWJRoBkggfu2mwlcBdfkbSoc-maEflfpLhSa3Oq_/exec";

// âœ… ë¬¸ì œì§‘ ë°ì´í„°
const data = {
  "ê°œë…ì„œ": {
    1: ["ìˆ˜í•™ì˜ ë°”ì´ë¸”","ë§ˆí”Œ êµê³¼ì„œ","ìˆ˜í•™ì˜ ì™•ë„","ì˜¬ë¦¼í¬ìŠ¤ ìˆ˜í•™","ê°œë… í”ŒëŸ¬ìŠ¤ ìœ í˜• ê³ ë“± ìˆ˜í•™","ì´ìœ ìˆëŠ” ìˆ˜í•™ ê°œë… SOS","ì…€íŒŒ í•´ë²•ìˆ˜í•™"],
    2: ["ìˆ˜í•™ì˜ ìƒ˜","ê°œë… ìˆ","í’ì‚°ì","ê°œë…ì›ë¦¬"],
    3: ["ê¸°ë³¸ ìˆ˜í•™ì˜ ì •ì„","ìˆ˜í•™ì¤‘ì‹¬ ê³ ë“±ìˆ˜í•™","ë©”ê°€ìŠ¤í„°ë”” ë¬¸ì œ ê¸°ë³¸ì„œ CPRìˆ˜í•™","ë” ê°œë… ë¸”ë™ë¼ë²¨"],
    4: ["ì‹¤ë ¥ ìˆ˜í•™ì˜ ì •ì„","ìˆ¨ë§ˆì¿°ë¼ìš°ë°"]
  },
  "ìœ í˜• ì‹¬í™”ì„œ": {
    1: ["ìˆ˜ë ¥ì¶©ì „","ìˆ˜í•™ì˜ ë°”ì´ë¸” BOB","ê°œë… í”ŒëŸ¬ìŠ¤ ìœ í˜• ë¼ì´íŠ¸","ë¼ì´íŠ¸ ìˆ","ìœ í˜• í•´ê²°ì˜ ë²•ì¹™","ì˜¬ë¦¼í¬ìŠ¤ ë‹¥í„°ë§"],
    2: ["ê°œë…ì›ë¦¬ RPM","í’ì‚°ì í•„ìˆ˜ìœ í˜•","ë‚´ê³µì˜ í˜","ì˜¬ë¦¬ë“œ","í•˜ì´ë¼ì´íŠ¸ ë‹¨ê¸° íŠ¹ê°•","ì‹¬í”Œ ìì´ìŠ¤í† ë¦¬"],
    3: ["ìˆ ìˆ˜í•™","ë§ˆí”Œ ì‹œë„ˆì§€","ì¼ë“±ê¸‰ ìˆ˜í•™","1ë“±ê¸‰ ë§Œë“¤ê¸°"],
    4: ["ì¼í’ˆ","ìš¸ë¦¼í¬ìŠ¤ ê³ ë‚œë„","ìˆ˜ëŠ¥ë‹¤í","ì ˆëŒ€ë“±ê¸‰","ìœ í˜•+ë‚´ì‹  ê³ ìŸì´","ë¸”ë™ë¼ë²¨","ë‚´ì‹  í•˜ì´ì•¤ë“œ","í˜„ìš°ì§„ ë‰´ëŸ°-ì‹œëƒ…ìŠ¤","ìˆ˜í•™ì˜ ì‹ "],
    5: ["TOT","531 í•˜ì´í¼","ì ˆëŒ€ë“±ê¸‰ ì½”ë“œì— ","í˜„ìš°ì§„ ë“œë¦´"]
  },
  "ê¸°ì¶œ": ["ìì´ìŠ¤í† ë¦¬","ì§± ì–´ë ¤ìš´ ìœ í˜• ê³ ë‚œë„ 4ì ì§œë¦¬ ìˆ˜í•™","ë„ˆí¬ë“¤ì˜ ê¸°ì¶œë¬¸ì œ","ë§ˆí”Œ ìˆ˜ëŠ¥ê¸°ì¶œì´ì •ë¦¬","ìˆ˜ëŠ¥ ê¸°ì¶œì˜ ë°”ì´ë¸”","ì‹¤ì „+ìˆ˜ëŠ¥ ê³ ìŸì´","ì–´ì‚¼ì‰¬ì‚¬","ë„ˆê¸°ì¶œ","ìˆ˜ëŠ¥ ê¸°ì¶œì˜ ë¯¸ë˜","ìˆ ê¸°ì¶œ","í‹°ì˜¤í”¼ í´ë˜ìŠ¤ ìˆ˜ëŠ¥ ê¸°ì¶œë¬¸ì œì§‘","ì´ë™í›ˆ ê¸°ì¶œë¬¸ì œì§‘","ë‹´ê¸ˆì§ˆ","ë°±ë¯¸","ê¸°ì¶œì˜ ê³ ë°±","ë§ˆë”í……","ì˜¬ë¦¼í¬ìŠ¤ ê¸°ì¶œë¬¸ì œì§‘"]
};

let currentPage = "home";
let selectedType = "";
let selectedLevel = "";
let numpadCode = "";

// ì´ˆê¸°í™”
function loadHome() {
  currentPage = "home";
  selectedType = "";
  selectedLevel = "";
  const chat = document.getElementById("chat-content");
  chat.innerHTML = `
    <div class="fade">
      <h3>ì–´ë–¤ ë¬¸ì œì§‘ ì¶”ì²œì´ í•„ìš”í•˜ì‹ ê°€ìš”?</h3>
      <button class="button" onclick="selectType('ê°œë…ì„œ')">ê°œë…ì„œ</button>
      <button class="button" onclick="selectType('ìœ í˜• ì‹¬í™”ì„œ')">ìœ í˜• ì‹¬í™”ì„œ</button>
      <button class="button" onclick="selectType('ê¸°ì¶œ')">ê¸°ì¶œ</button>
    </div>
  `;
}

function selectType(type) {
  selectedType = type;
  currentPage = "level";
  const chat = document.getElementById("chat-content");

  if (type === "ê°œë…ì„œ") {
    chat.innerHTML = `<h3>${type} ë‚œì´ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”</h3>` + [1,2,3,4].map(i => `<button class="button" onclick="showRecommend(${i})">${i}ë‹¨ê³„</button>`).join('');
  } else if (type === "ìœ í˜• ì‹¬í™”ì„œ") {
    chat.innerHTML = `<h3>${type} ë‚œì´ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”</h3>` + [1,2,3,4,5].map(i => `<button class="button" onclick="showRecommend(${i})">${i}ë‹¨ê³„</button>`).join('');
  } else {
    showRecommend();
  }
}

function showRecommend(level) {
  selectedLevel = level || "";
  currentPage = "result";
  const chat = document.getElementById("chat-content");

  let books;
  if (selectedType === "ê¸°ì¶œ") {
    books = data["ê¸°ì¶œ"];
  } else {
    books = data[selectedType][selectedLevel];
  }

  const recommend = books[Math.floor(Math.random() * books.length)];

  chat.innerHTML = `
    <div class="fade">
      <h3>ì¶”ì²œ ë¬¸ì œì§‘</h3>
      <p><b>${recommend}</b></p>
      <button class="button" onclick="openReviewInput('${recommend}')">í‰ê°€í•˜ê¸°</button>
    </div>
  `;
}

function openReviewInput(bookName) {
  const chat = document.getElementById("chat-content");
  chat.innerHTML += `
    <div class="fade" id="reviewBox">
      <textarea id="reviewText" rows="3" style="width:100%;border-radius:15px;padding:8px;margin-top:8px;"></textarea>
      <button class="button" onclick="submitReview('${bookName}')">ì œì¶œ</button>
    </div>
  `;
}

async function submitReview(bookName) {
  const text = document.getElementById("reviewText").value.trim();
  if (!text) return alert("í‰ê°€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");

  const params = new URLSearchParams({
    action: "write",
    type: selectedType,
    level: selectedLevel,
    book: bookName,
    review: text
  });

  await fetch(`${SCRIPT_URL}?${params.toString()}`);
  alert("í‰ê°€ê°€ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤!");
  document.getElementById("reviewBox").remove();
}

// ğŸ’– ë„˜íŒ¨ë“œ ê¸°ëŠ¥
document.getElementById("heartBtn").addEventListener("click", () => {
  document.getElementById("numpad").style.display = "flex";
  numpadCode = "";
});

document.querySelectorAll(".numpad-button").forEach(btn => {
  btn.addEventListener("click", e => {
    const val = e.target.textContent;
    if (val === "Clear") numpadCode = "";
    else if (val === "Enter") checkCode();
    else numpadCode += val;
  });
});

function checkCode() {
  if (numpadCode === "0411") {
    loadReviews();
  } else {
    alert("ì˜ëª»ëœ ì½”ë“œì…ë‹ˆë‹¤.");
  }
  document.getElementById("numpad").style.display = "none";
}

async function loadReviews() {
  const res = await fetch(`${SCRIPT_URL}?action=read`);
  const data = await res.json();
  const chat = document.getElementById("chat-content");
  chat.innerHTML = "<h3>ë‹¤ë¥¸ ì‚¬ìš©ìë“¤ì˜ í‰ê°€</h3>";
  data.slice(-10).forEach(r => {
    chat.innerHTML += `
      <div style="margin-bottom:10px;background:rgba(255,255,255,0.6);padding:8px;border-radius:10px;">
        <b>${r.book}</b> (${r.type} ${r.level || ""})<br>
        ${r.review}<br>
        <small>${r.datetime}</small>
      </div>
    `;
  });
}

// ë’¤ë¡œê°€ê¸° / ì²˜ìŒìœ¼ë¡œ ë²„íŠ¼
document.getElementById("homeBtn").addEventListener("click", loadHome);
document.getElementById("backBtn").addEventListener("click", () => {
  if (currentPage === "level") loadHome();
  else if (currentPage === "result") selectType(selectedType);
  else loadHome();
});

// ì‹œì‘
loadHome();
</script>
</body>
</html>
