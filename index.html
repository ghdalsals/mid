<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ë¬¸ì œì§‘ ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜</title>
<style>
:root{
  --bg:#f4f4f4;--chat-bg:#fff;--text:#1d1d1f;
  --btn:#e0e0e0;--btn-h:#d4d4d4;--btn-a:#c7c7c7;--bd:#ccc;
  --radius:18px;--shadow:0 6px 20px rgba(0,0,0,.08);--tr:all .25s ease;
}
body{background:var(--bg);font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","Noto Sans KR",sans-serif;display:flex;justify-content:center;align-items:center;height:100vh;margin:0}
.chat-container{width:440px;height:640px;background:var(--chat-bg);border-radius:var(--radius);box-shadow:var(--shadow);padding:22px;display:flex;flex-direction:column}
#chat-content{flex-grow:1;overflow-y:auto;scroll-behavior:smooth;color:var(--text);font-size:1rem}
h3{font-weight:600;font-size:1.1rem;margin-bottom:14px;text-align:center}
.button{background:var(--btn);color:var(--text);border:1px solid var(--bd);border-radius:var(--radius);padding:14px;margin:10px 0;font-size:1.05rem;cursor:pointer;width:100%;transition:var(--tr);box-sizing:border-box}
.button:hover{background:var(--btn-h);transform:translateY(-1px)}
.button:active{background:var(--btn-a);transform:scale(.98)}
.bottom-bar{display:flex;justify-content:space-between;gap:10px;margin-top:10px}
textarea{width:100%;border-radius:12px;padding:10px;border:1px solid #bbb;font-family:inherit;resize:none;font-size:.95rem;color:#000;background:#fafafa;box-sizing:border-box}
.recommend-item{background:#f9f9f9;color:#000;border-radius:12px;padding:10px 14px;margin:6px 0;box-shadow:0 2px 6px rgba(0,0,0,.03);transition:var(--tr)}
.recommend-item:hover{transform:translateY(-2px)}
.emoji-container{display:grid;grid-template-columns:repeat(5,1fr);gap:12px;margin-top:10px;justify-items:center;align-items:center}
.emoji{font-size:2.2rem;cursor:pointer;transition:transform .25s ease, filter .25s ease}
@media (hover:hover){ .emoji:hover{transform:scale(1.1)} }
.selected{transform:scale(1.25) !important;filter:drop-shadow(0 0 5px #555) !important}
/* ğŸ ì• í”Œ ëŠë‚Œ bounce íš¨ê³¼ */
@keyframes bounce {
  0% { transform: scale(1); }
  40% { transform: scale(1.35); }
  60% { transform: scale(0.95); }
  80% { transform: scale(1.15); }
  100% { transform: scale(1.2); }
}
.bounce { animation: bounce 0.4s cubic-bezier(.25,.46,.45,.94); }
</style>
</head>

<body>
<div class="chat-container">
  <div id="chat-content"></div>
  <div class="bottom-bar">
    <button class="button" id="backBtn">â†</button>
    <button class="button" id="homeBtn">âŒ‚</button>
    <button class="button" id="heartBtn">ğŸ’–</button>
  </div>
</div>

<script>
const SCRIPT_URL="https://script.google.com/macros/s/AKfycbypbNF4_cfeeRuscpeg6WcNMr1pM3S6Pz_XBoY6UCBOTKIRqSF_gqIau6RkkQpT-MCp/exec";
if(!localStorage.getItem("sessionId")){localStorage.setItem("sessionId","sess-"+Math.random().toString(36).slice(2,11))}
const SESSION_ID=localStorage.getItem("sessionId");
fetch(`${SCRIPT_URL}?action=visit&session=${SESSION_ID}`);

const data={
  "ê°œë…ì„œ":{1:["ìˆ˜í•™ì˜ ë°”ì´ë¸”","ë§ˆí”Œ êµê³¼ì„œ","ìˆ˜í•™ì˜ ì™•ë„","ì˜¬ë¦¼í¬ìŠ¤ ìˆ˜í•™","ê°œë… í”ŒëŸ¬ìŠ¤ ìœ í˜• ê³ ë“± ìˆ˜í•™","ì´ìœ ìˆëŠ” ìˆ˜í•™ ê°œë… SOS","ì…€íŒŒ í•´ë²•ìˆ˜í•™"],2:["ìˆ˜í•™ì˜ ìƒ˜","ê°œë… ìˆ","í’ì‚°ì","ê°œë…ì›ë¦¬"],3:["ê¸°ë³¸ ìˆ˜í•™ì˜ ì •ì„","ìˆ˜í•™ì¤‘ì‹¬ ê³ ë“±ìˆ˜í•™","ë©”ê°€ìŠ¤í„°ë”” ë¬¸ì œ ê¸°ë³¸ì„œ CPRìˆ˜í•™","ë” ê°œë… ë¸”ë™ë¼ë²¨"],4:["ì‹¤ë ¥ ìˆ˜í•™ì˜ ì •ì„","ìˆ¨ë§ˆì¿°ë¼ìš°ë°"]},
  "ìœ í˜• ì‹¬í™”ì„œ":{1:["ìˆ˜ë ¥ì¶©ì „","ìˆ˜í•™ì˜ ë°”ì´ë¸” BOB","ê°œë… í”ŒëŸ¬ìŠ¤ ìœ í˜• ë¼ì´íŠ¸","ë¼ì´íŠ¸ ìˆ","ìœ í˜• í•´ê²°ì˜ ë²•ì¹™","ì˜¬ë¦¼í¬ìŠ¤ ë‹¥í„°ë§"],2:["ê°œë…ì›ë¦¬ RPM","í’ì‚°ì í•„ìˆ˜ìœ í˜•","ë‚´ê³µì˜ í˜","ì˜¬ë¦¬ë“œ","í•˜ì´ë¼ì´íŠ¸ ë‹¨ê¸° íŠ¹ê°•","ì‹¬í”Œ ìì´ìŠ¤í† ë¦¬"],3:["ìˆ ìˆ˜í•™","ë§ˆí”Œ ì‹œë„ˆì§€","ì¼ë“±ê¸‰ ìˆ˜í•™","1ë“±ê¸‰ ë§Œë“¤ê¸°"],4:["ì¼í’ˆ","ìš¸ë¦¼í¬ìŠ¤ ê³ ë‚œë„","ìˆ˜ëŠ¥ë‹¤í","ì ˆëŒ€ë“±ê¸‰","ìœ í˜•+ë‚´ì‹  ê³ ìŸì´","ë¸”ë™ë¼ë²¨","ë‚´ì‹  í•˜ì´ì•¤ë“œ","í˜„ìš°ì§„ ë‰´ëŸ°-ì‹œëƒ…ìŠ¤","ìˆ˜í•™ì˜ ì‹ "],5:["TOT","531 í•˜ì´í¼","ì ˆëŒ€ë“±ê¸‰ ì½”ë“œì— ","í˜„ìš°ì§„ ë“œë¦´"]},
  "ê¸°ì¶œ":["ìì´ìŠ¤í† ë¦¬","ì§± ì–´ë ¤ìš´ ìœ í˜• ê³ ë‚œë„ 4ì ì§œë¦¬ ìˆ˜í•™","ë„ˆí¬ë“¤ì˜ ê¸°ì¶œë¬¸ì œ","ë§ˆí”Œ ìˆ˜ëŠ¥ê¸°ì¶œì´ì •ë¦¬","ìˆ˜ëŠ¥ ê¸°ì¶œì˜ ë°”ì´ë¸”","ì‹¤ì „+ìˆ˜ëŠ¥ ê³ ìŸì´","ì–´ì‚¼ì‰¬ì‚¬","ë„ˆê¸°ì¶œ","ìˆ˜ëŠ¥ ê¸°ì¶œì˜ ë¯¸ë˜","ìˆ ê¸°ì¶œ","í‹°ì˜¤í”¼ í´ë˜ìŠ¤ ìˆ˜ëŠ¥ ê¸°ì¶œë¬¸ì œì§‘","ì´ë™í›ˆ ê¸°ì¶œë¬¸ì œì§‘","ë‹´ê¸ˆì§ˆ","ë°±ë¯¸","ê¸°ì¶œì˜ ê³ ë°±","ë§ˆë”í……","ì˜¬ë¦¼í¬ìŠ¤ ê¸°ì¶œë¬¸ì œì§‘"]
};

let satisfaction="";let selectedType="";let selectedLevel="";

// ğŸµ ë”¸ê¹ ì‚¬ìš´ë“œ ì´ˆê¸°í™”
const clickSound = new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");
clickSound.volume = 0.3;

function loadHome(){
  const chat=document.getElementById("chat-content");
  chat.innerHTML=`
    <div>
      <h3>ì–´ë–¤ ë¬¸ì œì§‘ ì¶”ì²œì´ í•„ìš”í•˜ì‹ ê°€ìš”?</h3>
      <button class="button" onclick="selectType('ê°œë…ì„œ')">ê°œë…ì„œ</button>
      <button class="button" onclick="selectType('ìœ í˜• ì‹¬í™”ì„œ')">ìœ í˜• ì‹¬í™”ì„œ</button>
      <button class="button" onclick="selectType('ê¸°ì¶œ')">ê¸°ì¶œ</button>
    </div>`;
}

function selectType(type){
  selectedType=type;
  const chat=document.getElementById("chat-content");
  if(type==="ê°œë…ì„œ"){
    chat.innerHTML=`<h3>${type} ë‚œì´ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”</h3>`+[1,2,3,4].map(i=>`<button class="button" onclick="showRecommend(${i})">${i}ë‹¨ê³„</button>`).join('');
  }else if(type==="ìœ í˜• ì‹¬í™”ì„œ"){
    chat.innerHTML=`<h3>${type} ë‚œì´ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”</h3>`+[1,2,3,4,5].map(i=>`<button class="button" onclick="showRecommend(${i})">${i}ë‹¨ê³„</button>`).join('');
  }else{ showRecommend(); }
}

function showRecommend(level){
  selectedLevel=level||"";
  const chat=document.getElementById("chat-content");
  const books=(selectedType==="ê¸°ì¶œ")?data["ê¸°ì¶œ"]:data[selectedType][selectedLevel];
  chat.innerHTML=`
    <div>
      <h3>ì¶”ì²œ ë¬¸ì œì§‘ ëª©ë¡</h3>
      ${books.map(b=>`<div class="recommend-item">${b}</div>`).join('')}
      <button class="button" onclick="openSatisfaction()">í‰ê°€í•˜ê¸°</button>
    </div>`;
}

function openSatisfaction(){
  const chat=document.getElementById("chat-content");
  chat.innerHTML+=`
    <div id="satisfactionBox">
      <h3>ì´ ì¶”ì²œì— ì–¼ë§ˆë‚˜ ë§Œì¡±í•˜ì‹œë‚˜ìš”?</h3>
      <div class="emoji-container">
        <span class="emoji" data-value="ë¶ˆë§Œì¡±">ğŸ˜¡</span>
        <span class="emoji" data-value="ì¡°ê¸ˆ ë¶ˆë§Œì¡±">ğŸ˜•</span>
        <span class="emoji" data-value="ë³´í†µ">ğŸ˜</span>
        <span class="emoji" data-value="ë§Œì¡±">ğŸ™‚</span>
        <span class="emoji" data-value="ë§¤ìš° ë§Œì¡±">ğŸ˜</span>
      </div>
    </div>`;

  document.querySelectorAll(".emoji").forEach(el=>{
    el.addEventListener("click",function(){
      document.querySelectorAll(".emoji").forEach(e=>{e.classList.remove("selected","bounce");});
      void this.offsetHeight; // reflow
      this.classList.add("selected","bounce");
      satisfaction=this.getAttribute("data-value");
      clickSound.currentTime = 0;
      clickSound.play(); // ğŸ”Š í´ë¦­í•  ë•Œ ì‚¬ìš´ë“œ

      if(!document.getElementById("reviewBox")){
        chat.innerHTML+=`
          <div id="reviewBox">
            <textarea id="reviewText" rows="3" placeholder="ì˜ê²¬ì„ ì‘ì„±í•´ì£¼ì„¸ìš”..."></textarea>
            <button class="button" onclick="submitReview()">ì œì¶œ</button>
          </div>`;
      }
      const c=document.getElementById("chat-content");
      c.scrollTop=c.scrollHeight;
    },{passive:true});
  });
  const c=document.getElementById("chat-content");
  c.scrollTop=c.scrollHeight;
}

async function submitReview(){
  const text=document.getElementById("reviewText").value.trim();
  if(!text){alert("ì˜ê²¬ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");return;}
  await fetch(`${SCRIPT_URL}?action=review&type=${selectedType}&level=${selectedLevel}&review=${encodeURIComponent("["+satisfaction+"] "+text)}&session=${SESSION_ID}`);
  alert("í‰ê°€ê°€ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤!");
  loadHome();
}
loadHome();
</script>
</body>
</html>
